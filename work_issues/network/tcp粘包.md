

# tcp粘包原因及粘包解决方式

近期在项目中的通信模块中发现tcp通信模块中，如果连续调用write发送数据的话，就会出现粘包现象，因为本来对tcp协议也不够熟悉，所以当时就大致猜测是因为tcp底层实现使用一个buffer将`socket.write()`的数据缓存起来，在某种条件下再将buffer中的数据真正的发出去，这样的话，在短时间内连续write的数据就会一起发送出去，从而造成粘包现象。

那么发生粘包的真正原因是什么呢？再查阅了相关的资料之后发现主要可能由下面两个原因造成：

1. 由于nagle算法导致的粘包：nagle算法会优化小数据包的发送，简单来说，就是将多个小数据包合并成一个包进行发送，详细流程会在下面进行介绍。
2. 由于接收端不及时导致粘包：如接收端的read线程被阻塞，tcp会先将接收到的数据保存在缓冲区中，这样在接收端进行read的时候可能缓冲区中已经接收了多个数据包，从而导致粘包，这与tcp的滑动窗口机制有关。